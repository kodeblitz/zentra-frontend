<div class="flex flex-col gap-4 p-4">
    <header class="flex items-center gap-4">
        <p-button icon="pi pi-arrow-left" [rounded]="true" [text]="true" (onClick)="volver()" ariaLabel="Volver" />
        <h1 class="m-0 text-xl font-semibold">Compra {{ compra()?.numero || compra()?.id }}</h1>
        @if (compra()?.estado) {
            <p-tag [value]="compra()?.estado" severity="info" />
        }
    </header>

    @if (loading()) {
        <p class="text-muted-color">Cargando...</p>
    } @else if (compra()) {
        <p-card header="Datos generales" styleClass="mb-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <span class="block text-muted-color text-sm">Proveedor</span>
                    <span class="font-semibold">{{ getProveedorNombre() }}</span>
                </div>
                <div>
                    <span class="block text-muted-color text-sm">Número</span>
                    <span>{{ compra()!.numero || compra()!.id }}</span>
                </div>
                <div>
                    <span class="block text-muted-color text-sm">Fecha</span>
                    <span>{{ compra()!.fechaCompra | date:'dd/MM/yyyy' }}</span>
                </div>
                <div>
                    <span class="block text-muted-color text-sm">Moneda</span>
                    <span>{{ getSimboloMoneda() }}</span>
                </div>
                @if (compra()!.cotizacion) {
                    <div>
                        <span class="block text-muted-color text-sm">Cotización</span>
                        <span>1 {{ getSimboloMoneda() }} = {{ compra()!.cotizacion | number:'1.2-2' }} Gs.</span>
                    </div>
                }
                <div>
                    <span class="block text-muted-color text-sm">Total</span>
                    <span class="font-semibold">{{ compra()!.total | number:'1.0-0' }} {{ getSimboloMoneda() }}</span>
                </div>
            </div>
            @if (compra()!.observaciones) {
                <div class="mt-4">
                    <span class="block text-muted-color text-sm">Observaciones</span>
                    <span>{{ compra()!.observaciones }}</span>
                </div>
            }
        </p-card>

        <p-card header="Detalle">
            <p-table [value]="compra()!.detalle ?? []" [tableStyle]="{ 'min-width': '100%' }" styleClass="p-datatable-sm">
                <ng-template #header>
                    <tr>
                        <th>Descripción</th>
                        <th class="text-right w-24">Cant.</th>
                        <th class="text-right w-28">P. unit.</th>
                        <th class="text-right w-28">Total</th>
                    </tr>
                </ng-template>
                <ng-template #body let-line>
                    <tr>
                        <td>{{ getDescripcionLinea(line) }}</td>
                        <td class="text-right">{{ line.cantidad | number:'1.2-2' }}</td>
                        <td class="text-right">{{ line.precioUnitario | number:'1.0-0' }} {{ getSimboloMoneda() }}</td>
                        <td class="text-right font-semibold">{{ line.totalLinea | number:'1.0-0' }} {{ getSimboloMoneda() }}</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-card>
    }
</div>
