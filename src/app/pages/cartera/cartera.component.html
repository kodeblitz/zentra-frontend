<p-toast />
<p-tabs value="0">
    <p-tablist>
        <p-tab value="0">Saldos por cliente</p-tab>
        <p-tab value="1">Documentos con saldo</p-tab>
        <p-tab value="2">Aging</p-tab>
    </p-tablist>
    <p-tabpanels>
        <p-tabpanel value="0">
            <p-table
                [value]="saldosCliente()"
                [rows]="15"
                [paginator]="true"
                [tableStyle]="{ 'min-width': '40rem' }"
                dataKey="clienteId"
                currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}"
                [showCurrentPageReport]="true"
            >
                <ng-template #header>
                    <tr>
                        <th>Cliente</th>
                        <th>Saldo documentos</th>
                        <th>Saldo créditos</th>
                        <th>Saldo total</th>
                    </tr>
                </ng-template>
                <ng-template #body let-row>
                    <tr>
                        <td>{{ row.razonSocial }}</td>
                        <td>{{ row.saldoDocumentos | number:'1.2-2' }}</td>
                        <td>{{ row.saldoCreditos | number:'1.2-2' }}</td>
                        <td>{{ row.saldoTotal | number:'1.2-2' }}</td>
                    </tr>
                </ng-template>
                <ng-template #emptymessage>
                    <tr><td colspan="4">No hay datos.</td></tr>
                </ng-template>
            </p-table>
        </p-tabpanel>
        <p-tabpanel value="1">
            <p-table
                [value]="documentosConSaldo()"
                [rows]="15"
                [paginator]="true"
                [tableStyle]="{ 'min-width': '50rem' }"
                dataKey="documentoVentaId"
                currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords}"
                [showCurrentPageReport]="true"
            >
                <ng-template #header>
                    <tr>
                        <th>Cliente</th>
                        <th>Número</th>
                        <th>Fecha emisión</th>
                        <th>Vencimiento</th>
                        <th>Total</th>
                        <th>Saldo pendiente</th>
                        <th>Días vencido</th>
                    </tr>
                </ng-template>
                <ng-template #body let-row>
                    <tr>
                        <td>{{ row.razonSocial }}</td>
                        <td>{{ row.numero }}</td>
                        <td>{{ row.fechaEmision }}</td>
                        <td>{{ row.fechaVencimiento }}</td>
                        <td>{{ row.total | number:'1.2-2' }}</td>
                        <td>{{ row.saldoPendiente | number:'1.2-2' }}</td>
                        <td><p-tag [value]="row.diasVencido?.toString() ?? '0'" [severity]="row.diasVencido && row.diasVencido > 0 ? 'warn' : 'success'" /></td>
                    </tr>
                </ng-template>
                <ng-template #emptymessage>
                    <tr><td colspan="7">No hay documentos con saldo.</td></tr>
                </ng-template>
            </p-table>
        </p-tabpanel>
        <p-tabpanel value="2">
            <div class="mb-4">
                <p-button label="Actualizar" icon="pi pi-refresh" (onClick)="loadAging()" />
            </div>
            <div *ngIf="aging()" class="grid grid-cols-12 gap-4 mb-4">
                <p-card class="col-span-3" header="0-30 días">
                    <p class="text-2xl font-bold">{{ aging()!.rango0_30 | number:'1.2-2' }}</p>
                </p-card>
                <p-card class="col-span-3" header="31-60 días">
                    <p class="text-2xl font-bold">{{ aging()!.rango31_60 | number:'1.2-2' }}</p>
                </p-card>
                <p-card class="col-span-3" header="61-90 días">
                    <p class="text-2xl font-bold">{{ aging()!.rango61_90 | number:'1.2-2' }}</p>
                </p-card>
                <p-card class="col-span-3" header="+90 días">
                    <p class="text-2xl font-bold">{{ aging()!.rango91Mas | number:'1.2-2' }}</p>
                </p-card>
            </div>
            <p-card *ngIf="aging()" header="Total cartera">
                <p class="text-2xl font-bold">{{ aging()!.total | number:'1.2-2' }}</p>
            </p-card>
            <p-table
                *ngIf="aging()?.detalle?.length"
                [value]="aging()!.detalle"
                [rows]="15"
                [paginator]="true"
                [tableStyle]="{ 'min-width': '50rem' }"
                class="mt-4"
            >
                <ng-template #header>
                    <tr>
                        <th>Cliente</th>
                        <th>Número</th>
                        <th>Saldo</th>
                        <th>Días vencido</th>
                    </tr>
                </ng-template>
                <ng-template #body let-row>
                    <tr>
                        <td>{{ row.razonSocial }}</td>
                        <td>{{ row.numero }}</td>
                        <td>{{ row.saldoPendiente | number:'1.2-2' }}</td>
                        <td>{{ row.diasVencido }}</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-tabpanel>
    </p-tabpanels>
</p-tabs>
